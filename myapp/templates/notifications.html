{% load static %}

<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</title>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Reset and base styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Prompt', sans-serif;
        }

        body {
            background-color: #f5f7fa;
            color: #333;
            padding: 20px;
            min-height: 100vh;
        }

        /* Notifications container */
        .notifications-container {
            max-width: 800px;
            margin: 20px auto;
            background-color: #fff;
            border-radius: 12px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
            padding: 25px;
            position: relative;
        }

        .notification-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .auto-refresh {
            display: flex;
            align-items: center;
            font-size: 14px;
        }
        
        .auto-refresh label {
            display: flex;
            align-items: center;
            gap: 5px;
            cursor: pointer;
        }
        
        .auto-refresh input[type="checkbox"] {
            cursor: pointer;
        }
        
        h2 {
            font-size: 24px;
            color: #333;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 0;
        }
        
        /* ‡πÑ‡∏ü‡∏Å‡∏£‡∏∞‡∏û‡∏£‡∏¥‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå */
        .live-indicator {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 14px;
            color: #f44336;
            font-weight: 500;
        }
        
        .live-dot {
            display: inline-block;
            width: 8px;
            height: 8px;
            background-color: #f44336;
            border-radius: 50%;
            animation: livePulse 1.5s infinite;
        }
        
        @keyframes livePulse {
            0% { opacity: 1; }
            50% { opacity: 0.4; }
            100% { opacity: 1; }
        }

        /* Notification list */
        #notification-list {
            list-style: none;
            margin-bottom: 20px;
            max-height: 70vh;
            overflow-y: auto;
            padding-right: 5px;
        }

        .notification-item {
            padding: 16px;
            border-radius: 10px;
            margin-bottom: 14px;
            border-left: 4px solid #ddd;
            background-color: #f9f9f9;
            transition: all 0.3s ease;
            position: relative;
            cursor: pointer;
        }

        /* Unread notifications */
        .notification-item.unread {
            background-color: #e8f4ff;
            border-left: 4px solid #007bff;
            box-shadow: 0 2px 8px rgba(0, 123, 255, 0.15);
        }

        /* Read notifications */
        .notification-item:not(.unread) {
            background-color: #f8f8f8;
            border-left: 4px solid #c0c0c0;
            color: #555;
        }

        .notif-content {
            font-size: 15px;
            line-height: 1.5;
            margin-bottom: 10px;
        }

        .notif-time {
            font-size: 12px;
            color: #777;
            text-align: right;
        }

        .notification-item.unread .notif-time {
            color: #0066cc;
            font-weight: 500;
        }

        /* Empty state */
        .no-notifications {
            text-align: center;
            padding: 40px 20px;
            color: #888;
            font-size: 16px;
            background-color: #f9f9f9;
            border-radius: 10px;
            margin: 20px 0;
        }

        /* Footer controls */
        .footer-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 15px;
        }
        
        /* Buttons */
        .mark-all-read-btn, .refresh-btn {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 6px rgba(0, 123, 255, 0.2);
        }

        .mark-all-read-btn:hover, .refresh-btn:hover {
            background-color: #0069d9;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 123, 255, 0.3);
        }
        
        .refresh-btn {
            background-color: #6c757d;
        }
        
        .refresh-btn:hover {
            background-color: #5a6268;
        }

        /* Hover effects */
        .notification-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
        }

        .notification-item.unread:hover {
            background-color: #d9edff;
        }

        .notification-item:not(.unread):hover {
            background-color: #f1f1f1;
        }

        /* Animation for new notifications */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-15px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .notification-item.new {
            animation: fadeIn 0.5s ease forwards;
        }
        
        /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏≠‡∏ô‡∏¥‡πÄ‡∏°‡∏ä‡∏±‡πà‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÑ‡∏Æ‡πÑ‡∏•‡∏ó‡πå‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÉ‡∏´‡∏°‡πà (‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå) */
        @keyframes highlightPulse {
            0% { box-shadow: 0 0 0 0 rgba(0, 123, 255, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(0, 123, 255, 0); }
            100% { box-shadow: 0 0 0 0 rgba(0, 123, 255, 0); }
        }
        
        .notification-item.highlight-new {
            animation: highlightPulse 1.5s ease-out;
        }

        /* Indicator for unread notifications */
        .notification-item.unread::after {
            content: '';
            position: absolute;
            top: 16px;
            right: 16px;
            width: 8px;
            height: 8px;
            background-color: #007bff;
            border-radius: 50%;
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .notifications-container {
                padding: 15px;
                margin: 10px;
            }
            
            h2 {
                font-size: 20px;
                margin-bottom: 20px;
            }
            
            .notification-item {
                padding: 14px;
            }
            
            .notif-content {
                font-size: 14px;
            }
            
            .mark-all-read-btn {
                width: 100%;
                padding: 12px 15px;
            }
        }

        /* Scrollbar styling */
        #notification-list::-webkit-scrollbar {
            width: 6px;
        }

        #notification-list::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        #notification-list::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 10px;
        }

        #notification-list::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
    </style>
</head>
<body>
    <div class="notifications-container">
        <div class="notification-header">
            <h2>üîî ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</h2>
            <div class="controls">
                <div class="auto-refresh">
                    <label>
                        <input type="checkbox" id="autoRefreshToggle" checked>
                        <span>‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</span>
                    </label>
                </div>
                <div class="live-indicator">
                    <span class="live-dot"></span> Live
                </div>
            </div>
        </div>
        
        <ul id="notification-list">
            {% if notifications %}
                {% for notification in notifications %}
                <li class="notification-item {% if not notification.is_read %}unread{% endif %}" data-id="{{ notification.id }}">
                    <div class="notif-content">
                        {{ notification.message|safe }}  
                    </div>
                    <div class="notif-time">{{ notification.created_at|date:"d/m/Y H:i" }}</div>
                </li>
                {% endfor %}
            {% else %}
                <li class="no-notifications">‚úÖ ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</li>
            {% endif %}
        </ul>

        {% if notifications %}
        <div class="footer-controls">
            <form id="mark-all-form" action="{% url 'mark_notification_as_read' %}" method="post">
                {% csrf_token %}
                <input type="hidden" name="mark_all" value="true">
                <button type="submit" class="mark-all-read-btn">‚úÖ ‡∏ó‡∏≥‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡∏ß‡πà‡∏≤‡∏≠‡πà‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
            </form>
            <button class="refresh-btn" id="refresh-button">‚Üª ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
        </div>
        {% endif %}
    </div>

    <script>
        // ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ global
        let notificationInterval = null;
        let lastResponseData = null;
        
        document.addEventListener('DOMContentLoaded', function() {
            // ‡πÄ‡∏û‡∏¥‡πà‡∏° event listener ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
            setupNotificationListeners();
            
            // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
            const autoRefreshToggle = document.getElementById('autoRefreshToggle');
            autoRefreshToggle.addEventListener('change', function() {
                if (this.checked) {
                    // ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
                    notificationInterval = setInterval(loadNotifications, 15000);
                    document.querySelector('.live-dot').style.display = 'inline-block';
                    document.querySelector('.live-indicator').style.color = '#f44336';
                    document.querySelector('.live-indicator').innerHTML = '<span class="live-dot"></span> Live';
                } else {
                    // ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
                    clearInterval(notificationInterval);
                    document.querySelector('.live-dot').style.display = 'none';
                    document.querySelector('.live-indicator').style.color = '#888';
                    document.querySelector('.live-indicator').textContent = 'Paused';
                }
            });
            
            // ‡∏õ‡∏∏‡πà‡∏°‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏ô‡πÄ‡∏≠‡∏á
            const refreshButton = document.getElementById('refresh-button');
            if (refreshButton) {
                refreshButton.addEventListener('click', manualRefresh);
            }
            
            // ‡∏™‡πà‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ó‡∏≥‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡∏ß‡πà‡∏≤‡∏≠‡πà‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏î‡πâ‡∏ß‡∏¢ JavaScript
            const markAllForm = document.getElementById('mark-all-form');
            if (markAllForm) {
                markAllForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    markAllAsRead();
                });
            }
            
            // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
            notificationInterval = setInterval(loadNotifications, 15000);
            
            // ‡∏´‡∏¢‡∏∏‡∏î‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÅ‡∏ó‡πá‡∏ö‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
            document.addEventListener('visibilitychange', function() {
                if (document.hidden) {
                    clearInterval(notificationInterval);
                } else {
                    if (document.getElementById('autoRefreshToggle').checked) {
                        loadNotifications();
                        clearInterval(notificationInterval);
                        notificationInterval = setInterval(loadNotifications, 15000);
                    }
                }
            });
            
            // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡πÅ‡∏ó‡πá‡∏ö‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤
            updateUnreadBadge();
        });
        
        // ‡πÄ‡∏û‡∏¥‡πà‡∏° event listener ‡πÉ‡∏´‡πâ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏∏‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
        function setupNotificationListeners() {
            document.querySelectorAll('.notification-item').forEach(item => {
                item.addEventListener('click', function() {
                    const notificationId = this.dataset.id;
                    markAsRead(notificationId, this);
                });
            });
        }

        // ‡∏ó‡∏≥‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡∏ß‡πà‡∏≤‡∏≠‡πà‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß
        function markAsRead(notificationId, element) {
            if (element.classList.contains('unread')) {
                // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó UI ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
                element.classList.remove('unread');
                updateUnreadBadge();
                
                // ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ fetch ‡πÅ‡∏ö‡∏ö form data
                const formData = new FormData();
                formData.append('notification_id', notificationId);
                
                fetch("{% url 'mark_notification_as_read' %}", {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': "{{ csrf_token }}"
                    },
                    body: formData
                }).catch(error => {
                    console.error('Error:', error);
                });
            }
        }

        // ‡∏ó‡∏≥‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡∏ß‡πà‡∏≤‡∏≠‡πà‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
        function markAllAsRead() {
            // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó UI ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
            document.querySelectorAll('.notification-item.unread').forEach(item => {
                item.classList.remove('unread');
            });
            updateUnreadBadge();
            
            // ‡∏ã‡πà‡∏≠‡∏ô‡∏õ‡∏∏‡πà‡∏°
            const markAllForm = document.getElementById('mark-all-form');
            if (markAllForm) {
                markAllForm.style.display = 'none';
            }
            
            // ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå
            const formData = new FormData();
            formData.append('mark_all', 'true');
            
            fetch("{% url 'mark_notification_as_read' %}", {
                method: 'POST',
                headers: {
                    'X-CSRFToken': "{{ csrf_token }}"
                },
                body: formData
            }).catch(error => {
                console.error('Error:', error);
            });
        }

        // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏≠‡πà‡∏≤‡∏ô
        function updateUnreadBadge() {
            const unreadCount = document.querySelectorAll('.notification-item.unread').length;
            
            // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏´‡∏ô‡πâ‡∏≤
            if (unreadCount > 0) {
                document.title = `(${unreadCount}) ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô`;
            } else {
                document.title = '‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô';
            }
            
            // ‡πÅ‡∏™‡∏î‡∏á/‡∏ã‡πà‡∏≠‡∏ô‡∏õ‡∏∏‡πà‡∏°‡∏ó‡∏≥‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡∏ß‡πà‡∏≤‡∏≠‡πà‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
            const markAllForm = document.getElementById('mark-all-form');
            if (markAllForm) {
                markAllForm.style.display = unreadCount > 0 ? 'block' : 'none';
            }
        }
        
        // ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏ô‡πÄ‡∏≠‡∏á
        function manualRefresh() {
            const refreshButton = document.querySelector('.refresh-btn');
            if (refreshButton) {
                refreshButton.textContent = '‚Üª ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...';
                refreshButton.disabled = true;
            }
            
            loadNotifications()
                .then(() => {
                    if (refreshButton) {
                        refreshButton.textContent = '‚Üª ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•';
                        refreshButton.disabled = false;
                    }
                })
                .catch(() => {
                    if (refreshButton) {
                        refreshButton.textContent = '‚Üª ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•';
                        refreshButton.disabled = false;
                    }
                });
        }
        
        // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
        function loadNotifications() {
            return new Promise((resolve, reject) => {
                const timestamp = new Date().getTime();
                
                fetch(`{% url 'api_member_notifications' %}?_=${timestamp}`)
                    .then(response => response.json())
                    .then(data => {
                        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
                        if (lastResponseData && JSON.stringify(data) === JSON.stringify(lastResponseData)) {
                            console.log("No changes in notifications");
                            resolve(data);
                            return;
                        }
                        
                        // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
                        lastResponseData = data;
                        
                        const notificationList = document.getElementById('notification-list');
                        
                        // ‡∏Å‡∏£‡∏ì‡∏µ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
                        if (data.notifications.length === 0) {
                            notificationList.innerHTML = "<li class='no-notifications'>‚úÖ ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</li>";
                            resolve(data);
                            return;
                        }
                        
                        // ‡πÄ‡∏Å‡πá‡∏ö ID ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß
                        const existingIds = new Set();
                        document.querySelectorAll('.notification-item').forEach(item => {
                            existingIds.add(item.dataset.id);
                        });
                        
                        // ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ß‡πà‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
                        const noNotificationsElement = document.querySelector('.no-notifications');
                        if (noNotificationsElement) {
                            notificationList.innerHTML = '';
                        }
                        
                        // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                        data.notifications.sort((a, b) => {
                            return new Date(b.created_at) - new Date(a.created_at);
                        });
                        
                        let hasNewNotifications = false;
                        
                        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÉ‡∏´‡∏°‡πà
                        data.notifications.forEach(notification => {
                            if (!existingIds.has(notification.id)) {
                                hasNewNotifications = true;
                                
                                const notifItem = document.createElement('li');
                                notifItem.className = `notification-item unread new`;
                                notifItem.dataset.id = notification.id;
                                notifItem.innerHTML = `
                                    <div class="notif-content">${notification.message}</div>
                                    <div class="notif-time">${notification.created_at}</div>
                                `;
                                
                                // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏ß‡πâ‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡∏™‡∏∏‡∏î
                                notificationList.insertBefore(notifItem, notificationList.firstChild);
                                
                                // ‡πÄ‡∏û‡∏¥‡πà‡∏° event listener
                                notifItem.addEventListener('click', function() {
                                    markAsRead(notification.id, this);
                                });
                                
                                // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå
                                setTimeout(() => {
                                    notifItem.classList.add('highlight-new');
                                    setTimeout(() => {
                                        notifItem.classList.remove('highlight-new');
                                    }, 2000);
                                }, 100);
                            }
                        });
                        
                        // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó UI
                        updateUnreadBadge();
                        resolve(data);
                    })
                    .catch(error => {
                        console.error('Error loading notifications:', error);
                        reject(error);
                    });
            });
        }
    </script>
</body>
</html>