{% load static %}

<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìú ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</title>
    
    <!-- CSS -->
    <link rel="stylesheet" href="{% static 'styles/order_history.css' %}">

    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
</head>
<body>

    <!-- Navbar -->
    <header class="navbar">
        <div class="logo">
            <a href="{% url 'home' %}">
                <img src="{% static 'media/logo.jpg' %}" alt="Shop Logo">
            </a>
        </div>
        <ul class="nav-links">
            <li><a href="{% url 'home' %}">üè† Home</a></li>
            <li><a href="{% url 'product_list' %}">üõç Products</a></li>
            <li><a href="{% url 'cart' %}">üõí Cart</a></li>
            <li><a href="{% url 'order_history' %}" class="active">üìú Order History</a></li>
        </ul>
    </header>

    <!-- Main Content -->
    <div class="container">
        <h1>üìú ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</h1>

        <table class="order-table">
            <thead>
                <tr>
                    <th>üìå Order ID</th>
                    <th>üè™ ‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤</th>
                    <th>üì¶ ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
                    <th>üìç ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</th>
                    <th>üìû ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</th>
                    <th>üí∞ ‡∏£‡∏≤‡∏Ñ‡∏≤</th>
                    <th>üí≥ ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</th>
                    <th>üöö ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</th>
                    <th>‚≠ê ‡∏£‡∏µ‡∏ß‡∏¥‡∏ß</th>
                </tr>
            </thead>
            <tbody>
                {% for order in orders %}
                <tr>
                    <td>#{{ order.id }}</td>
                    <td>{{ order.seller.store_name }}</td>
                    <td>
                        <ul>
                            {% for item in order.order_items.all %}
                                <li>{{ item.product.name }} x {{ item.quantity }} (‡∏ø{{ item.price_per_item }})</li>
                            {% endfor %}
                        </ul>
                    </td>
                    <td>{{ order.shipping_address }}</td>
                    <td>{{ order.phone_number }}</td>
                    <td>‡∏ø{{ order.total_price }}</td>
                    <td>
                        {% if order.payment_status == "paid" %}
                            <span class="paid">‚úÖ ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß</span>
                        {% elif order.payment_status == "pending" %}
                            <span class="pending-payment">‚è≥ ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</span>
                        {% elif order.payment_status == "rejected" %}
                            <span class="rejected">‚ùå ‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏ñ‡∏π‡∏Å‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò</span>
                        {% endif %}
                    </td>
                    <td class="status">
                        {% if order.status == "pending" %}
                            <span class="pending">üü† ‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</span>
                        {% elif order.status == "processing" %}
                            <span class="processing">üîÑ ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</span>
                        {% elif order.status == "shipped" %}
                            <span class="shipped">üöö ‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß</span>
                        {% elif order.status == "delivered" %}
                            <span class="delivered">‚úÖ ‡∏™‡πà‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if order.status == "delivered" %}
                            {% for item in order.order_items.all %}
                                {% with already_reviewed=False %}
                                    {% for review in item.product.reviews.all %}
                                        {% if review.user == request.user and review.order.id == order.id %}
                                            {% with already_reviewed=True %}
                                                <span class="reviewed">‚úÖ ‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡πÅ‡∏•‡πâ‡∏ß</span><br>
                                            {% endwith %}
                                        {% endif %}
                                    {% endfor %}

                                    {% if not already_reviewed %}
                                        <a href="{% url 'add_review' order.id item.product.id %}" class="btn-review">
                                            üìù ‡∏£‡∏µ‡∏ß‡∏¥‡∏ß {{ item.product.name }}
                                        </a><br>
                                    {% endif %}
                                {% endwith %}
                            {% endfor %}
                        {% else %}
                            <span class="no-review">‚ùå ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡πÑ‡∏î‡πâ</span>
                        {% endif %}
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="9">‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

</body>
</html>