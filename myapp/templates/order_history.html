{% load static %}
<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìú ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</title>
    
    <!-- ‚úÖ Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="{% static 'styles/order_his.css' %}">
    
    <!-- ‚úÖ Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" defer></script>
</head>
<body>

    <!-- üå∏ Navbar -->
    <header class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container">
            <a href="{% url 'home' %}" class="navbar-brand">
                <img src="{% static 'media/logo.jpg' %}" alt="Shop Logo" class="logo">
            </a>
            <ul class="navbar-nav ms-auto">
                <li class="nav-item"><a href="{% url 'home' %}" class="nav-link">üè† Home</a></li>
                <li class="nav-item"><a href="{% url 'product_list' %}" class="nav-link">üõç Products</a></li>
                <li class="nav-item"><a href="{% url 'cart' %}" class="nav-link">üõí Cart</a></li>
                <li class="nav-item"><a href="{% url 'order_history' %}" class="nav-link active">üìú Order History</a></li>
            </ul>
        </div>
    </header>

    <div class="container mt-4">
        <h2 class="text-center text-primary">üìú ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</h2>

        <!-- üîπ Bootstrap Tabs -->
        <ul class="nav nav-tabs mt-3" id="orderTabs">
            <li class="nav-item">
                <button class="nav-link active" id="pending-tab" data-bs-toggle="tab" data-bs-target="#pendingOrders">üì¶ ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</button>
            </li>
            <li class="nav-item">
                <button class="nav-link" id="completed-tab" data-bs-toggle="tab" data-bs-target="#completedOrders">‚úÖ ‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</button>
            </li>
        </ul>

        <!-- üîπ Tab Content -->
        <div class="tab-content mt-3">
            <!-- ‚úÖ ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏à‡∏±‡∏î‡∏™‡πà‡∏á -->
            <div class="tab-pane fade show active" id="pendingOrders">
                {% if pending_orders %}
                <table class="table table-striped text-center">
                    <thead class="table-danger">
                        <tr>
                            <th>#</th>
                            <th>‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤</th>
                            <th>‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
                            <th>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà</th>
                            <th>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</th>
                            <th>‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°</th>
                            <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</th>
                            <th>‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏•‡∏¥‡∏õ</th>
                            <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</th>
                            <th>‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏±‡∏ö</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for order in pending_orders %}
                        <tr>
                            <td>#{{ order.id }}</td>
                            <td>{{ order.seller.store_name }}</td>
                            <td>
                                <ul>
                                    {% for item in order.order_items.all %}
                                        <li>{{ item.product.name }} x {{ item.quantity }} (‡∏ø{{ item.price_per_item }})</li>
                                    {% endfor %}
                                </ul>
                            </td>
                            <td>{{ order.shipping_address }}</td>
                            <td>{{ order.phone_number }}</td>
                            <td>‡∏ø{{ order.total_price }}</td>
                            <td>
                                {% if order.payment_status == "pending" %}
                                    ‚è≥ ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô
                                {% elif order.payment_status == "paid" %}
                                    ‚úÖ ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß
                                {% else %}
                                    ‚ùå ‡∏ñ‡∏π‡∏Å‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò
                                {% endif %}
                            </td>
                            <td>
                                {% if order.payment_status == "pending" and not order.payment %}
                                    <a href="{% url 'upload_payment' order_ids=order.id %}" class="btn btn-warning btn-sm">üì§ ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î</a>
                                {% elif order.payment %}
                                    <a href="{{ order.payment.slip.url }}" target="_blank" class="btn btn-info btn-sm">üìú ‡∏î‡∏π‡∏™‡∏•‡∏¥‡∏õ</a>
                                {% else %}
                                    ‚úîÔ∏è ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢
                                {% endif %}
                            </td>
                            <td>
                                {% if order.status == "processing" %}
                                    üì¶ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏û‡πá‡∏Ñ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
                                {% elif order.status == "shipped" %}
                                    üöö ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏±‡∏î‡∏™‡πà‡∏á
                                {% else %}
                                    ‚è≥ ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô
                                {% endif %}
                            </td>
                            <td>
                                {% if order.status == "shipped" %}
                                    <a href="{% url 'confirm_delivery' order.id %}" class="btn btn-success btn-sm">‚úÖ ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß</a>
                                {% else %}
                                    -
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                {% else %}
                    <p class="text-center text-muted">üò¢ ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</p>
                {% endif %}
            </div>

            <!-- ‚úÖ ‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à -->
<div class="tab-pane fade" id="completedOrders">
    {% if completed_orders %}
    <table class="table table-striped text-center">
        <thead class="table-success">
            <tr>
                <th>#</th>
                <th>‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤</th>
                <th>‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
                <th>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà</th>
                <th>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</th>
                <th>‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°</th>
                <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</th>
                <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</th>
                <th>‡∏£‡∏µ‡∏ß‡∏¥‡∏ß</th>
            </tr>
        </thead>
        <tbody>
            {% for order in completed_orders %}
            <tr>
                <td>#{{ order.id }}</td>
                <td>{{ order.seller.store_name }}</td>
                <td>
                    <ul>
                        {% for item in order.order_items.all %}
                            <li>{{ item.product.name }} x {{ item.quantity }} (‡∏ø{{ item.price_per_item }})</li>
                        {% endfor %}
                    </ul>
                </td>
                <td>{{ order.shipping_address }}</td>
                <td>{{ order.phone_number }}</td>
                <td>‡∏ø{{ order.total_price }}</td>
                <td>‚úÖ ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß</td>
                <td>‚úÖ ‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</td>
                <td>
                    {% for item in order.order_items.all %}
                        {% with already_reviewed=False %}
                            {% for review in item.product.reviews.all %}
                                {% if review.user == request.user and review.order.id == order.id %}
                                    {% with already_reviewed=True %}
                                        <span class="reviewed">‚úÖ ‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡πÅ‡∏•‡πâ‡∏ß</span><br>
                                    {% endwith %}
                                {% endif %}
                            {% endfor %}

                            {% if not already_reviewed %}
                                <a href="{% url 'add_review' order.id item.product.id %}" class="btn-review">
                                    üìù ‡∏£‡∏µ‡∏ß‡∏¥‡∏ß {{ item.product.name }}
                                </a><br>
                            {% endif %}
                        {% endwith %}
                    {% endfor %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
        <p class="text-center text-muted">üò¢ ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</p>
    {% endif %}
</div>
</body>
</html>
